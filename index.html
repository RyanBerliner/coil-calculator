<form style="margin: 1rem 0;">
  <label style="display: block">
    Rider Weight (lbs)
    <input type="number" name="rider-weight" value="145">
  </label>
  <label style="display: block">
    Rear wheel travel (mm)
    <input type="number" name="travel" value="160">
  </label>
  <label style="display: block">
    Shock stroke (mm)
    <input type="number" name="stroke" value="60">
  </label>
  <label style="display: block; margin-top: 1rem;">
    Sag (%)
    <input type="number" name="sag" value="27">
  </label>
  <label style="display: block">
    Spring Weight (lbs/in)
    <input type="number" name="spring-weight" value="400">
  </label>
</form>

<script>
  const sagInput = document.querySelector('input[name="sag"]');
  const springWeightInput = document.querySelector('input[name="spring-weight"]');
  const form = document.querySelector('form');

  let riderWeight = 0;
  let wheelTravel = 0;
  let stroke = 0;
  let sag = 0;
  let springWeight = 0;
  let solveFor = 'weight';
  
  document.addEventListener('change', function(event) {
    if (event.target.getAttribute('name') === 'sag') solveFor = 'weight';
    else solveFor = 'sag';
    calculateCharacteristics();
  });

  form.addEventListener('submit', function(event) {
    event.preventDefault();
    calculateCharacteristics();
  });

  function calculateCharacteristics() {
    const data = new FormData(form);
    riderWeight = parseInt(data.get('rider-weight'));
    wheelTravel = parseInt(data.get('travel'));
    stroke = parseInt(data.get('stroke'));
    sag = parseInt(data.get('sag'));
    springWeight = parseInt(data.get('spring-weight'));

    const leverage = wheelTravel / stroke;
    // TODO: add in (part of) average weight of the bike itself?
    const rearTireBias = 0.65; // the rear wheel supports 65% of the riders weight
    const normWeight = riderWeight  * leverage * rearTireBias;

    // hooks law to solve for the spring rate
    // F = k*x
    // F   force
    // k   spring rate
    // x   deformation (sometimes called displacement)

    if (solveFor === 'weight') {
      const targetSagDistance = stroke * sag / 100;
      springWeight = normWeight / targetSagDistance; // lbs/mm
      springWeight *= 25.4 // lbs/in
      springWeight = parseInt(springWeight);
      springWeightInput.value = springWeight;
    } else {
      sag = normWeight / springWeight; // in
      sag *= 25.4 // mm
      sag /= stroke / 100 // %
      sag = Math.round(sag * 100) / 100; // round to 2 decimals (so users can see something is changing
      sagInput.value = sag;
    }
  }

  calculateCharacteristics();
</script>
